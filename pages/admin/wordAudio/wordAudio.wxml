<!--pages/admin/wordAudio/wordAudio.wxml-->
<view class="container">
  <view class="page-header">
    <text class="page-title">è¯æ±‡å½•éŸ³ç®¡ç†</text>
    <view class="page-desc">ç®¡ç†å’Œä¸Šä¼ è¯æ±‡çš„éŸ³é¢‘æ–‡ä»¶</view>
  </view>
  
  <!-- æ‰¹é‡ä¸Šä¼ å’Œæ‰¹é‡åˆ é™¤æŒ‰é’® -->
  <view class="action-buttons">
    <button class="action-btn upload-btn" bindtap="uploadAudioFiles">
      <text class="btn-icon">ğŸ“¤</text>
      <text>æ‰¹é‡ä¸Šä¼ å½•éŸ³</text>
    </button>
    
    <button class="action-btn delete-btn {{isSelectionMode ? 'active' : ''}}" bindtap="toggleSelectionMode">
      <text class="btn-icon">{{isSelectionMode ? 'âœ“' : 'ğŸ—‘ï¸'}}</text>
      <text>{{isSelectionMode ? 'å®Œæˆ' : 'æ‰¹é‡åˆ é™¤'}}</text>
    </button>
  </view>
  
  <view class="upload-tip">æ”¯æŒ.mp4æˆ–.aacæ ¼å¼ï¼Œæ–‡ä»¶åéœ€ä¸è¯æ±‡åç§°ä¸€è‡´</view>
  <view class="upload-status" wx:if="{{uploadStatus}}">{{uploadStatus}}</view>
  
  <!-- æ‰¹é‡åˆ é™¤æ§åˆ¶åŒº -->
  <view class="batch-delete-controls" wx:if="{{isSelectionMode}}">
    <view class="selection-info">å·²é€‰æ‹©: {{selectedItems.length}} ä¸ª</view>
    <view class="selection-actions">
      <button class="selection-btn select-all" bindtap="selectAll">å…¨é€‰</button>
      <button class="selection-btn select-none" bindtap="selectNone">å–æ¶ˆå…¨é€‰</button>
      <button class="selection-btn select-has" bindtap="selectHasAudio">é€‰æ‹©æœ‰å½•éŸ³</button>
      <button class="selection-btn delete" bindtap="deleteSelected" disabled="{{selectedItems.length === 0}}">åˆ é™¤é€‰ä¸­</button>
    </view>
  </view>
  
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-input-wrapper">
      <input 
        type="text" 
        placeholder="æœç´¢è¯æ±‡" 
        value="{{searchText}}"
        bindinput="onSearchInput"
        class="search-input"
      />
      <view class="search-icon">ğŸ”</view>
    </view>
  </view>
  
  <!-- è¿‡æ»¤å™¨ -->
  <view class="filter-bar">
    <view class="filter-title">å½•éŸ³çŠ¶æ€:</view>
    <view 
      class="filter-item {{hasAudioFilter === 'all' ? 'active' : ''}}" 
      bindtap="changeAudioFilter" 
      data-type="all"
    >å…¨éƒ¨</view>
    <view 
      class="filter-item {{hasAudioFilter === 'has' ? 'active' : ''}}" 
      bindtap="changeAudioFilter" 
      data-type="has"
    >æœ‰å½•éŸ³</view>
    <view 
      class="filter-item {{hasAudioFilter === 'none' ? 'active' : ''}}" 
      bindtap="changeAudioFilter" 
      data-type="none"
    >æ— å½•éŸ³</view>
  </view>
  
  <!-- ä¸Šä¼ è¿›åº¦ -->
  <view class="upload-progress" wx:if="{{isUploading}}">
    <view class="progress-info">
      <text>ä¸Šä¼ è¿›åº¦: {{uploadedCount}}/{{totalUploadCount}}</text>
      <text>{{uploadProgress}}%</text>
    </view>
    <progress percent="{{uploadProgress}}" stroke-width="4" color="#4CAF50" active show-info="{{false}}"></progress>
  </view>
  
  <!-- åˆ é™¤è¿›åº¦ -->
  <view class="delete-progress" wx:if="{{isDeleting}}">
    <view class="progress-info">
      <text>åˆ é™¤è¿›åº¦: {{deletedCount}}/{{totalDeleteCount}}</text>
      <text>{{deleteProgress}}%</text>
    </view>
    <progress percent="{{deleteProgress}}" stroke-width="4" color="#f44336" active show-info="{{false}}"></progress>
  </view>
  
  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-bar">
    <text>æ€»è®¡: {{totalWords}} ä¸ªè¯æ±‡</text>
    <text>ç¬¬ {{currentPage}}/{{totalPages}} é¡µ</text>
  </view>
  
  <!-- è¯æ±‡åˆ—è¡¨ -->
  <view class="word-list">
    <block wx:if="{{loading}}">
      <view class="loading-container">
        <view class="loading"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
    </block>
    
    <block wx:elif="{{filteredWords.length === 0}}">
      <view class="empty-state">
        <image class="empty-icon" src="/images/empty.png" mode="aspectFit"></image>
        <text>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„è¯æ±‡</text>
      </view>
    </block>
    
    <block wx:else>
      <view class="word-item-header">
        <view class="checkbox-col" wx:if="{{isSelectionMode}}"></view>
        <text class="word-col">è¯æ±‡</text>
        <text class="pinyin-col">æ‹¼éŸ³</text>
        <text class="status-col">å½•éŸ³çŠ¶æ€</text>
        <text class="action-col">æ“ä½œ</text>
      </view>
      
      <view class="word-items">
        <view 
          class="word-item {{isItemSelected(item.id || item._id) ? 'selected' : ''}}" 
          wx:for="{{filteredWords}}" 
          wx:key="id"
          data-word-id="{{item.id || item._id}}"
          data-word="{{item.word}}"
          bindtap="{{isSelectionMode ? 'toggleItemSelection' : ''}}"
        >
          <view class="checkbox-col" wx:if="{{isSelectionMode}}">
            <view class="checkbox {{isItemSelected(item.id || item._id) ? 'checked' : ''}}"></view>
          </view>
          <text class="word-col">{{item.word}}</text>
          <text class="pinyin-col">{{item.pinyin || '-'}}</text>
          <view class="status-col">
            <view class="status-badge {{item.audioFileId ? 'has-audio' : 'no-audio'}}">
              {{item.audioFileId ? 'æœ‰å½•éŸ³' : 'æ— å½•éŸ³'}}
            </view>
          </view>
          <view class="action-col">
            <block wx:if="{{!isSelectionMode}}">
              <block wx:if="{{item.audioFileId}}">
                <view class="action-button play-button" catchtap="playAudio" data-word="{{item.word}}">
                  <text>æ’­æ”¾</text>
                </view>
                <view class="action-button delete-button" catchtap="deleteSingleAudio" data-word="{{item.word}}" data-word-id="{{item.id || item._id}}">
                  <text>åˆ é™¤</text>
                </view>
              </block>
              <view 
                class="action-button edit-button"
                catchtap="goToWordDetail"
                data-wordid="{{item.id || item._id}}"
                data-word="{{item.word}}"
              >
                <text>ç¼–è¾‘</text>
              </view>
            </block>
          </view>
        </view>
      </view>
      
      <!-- åˆ†é¡µæ§åˆ¶ -->
      <view class="pagination">
        <view 
          class="page-button {{currentPage === 1 ? 'disabled' : ''}}"
          bindtap="prevPage"
        >
          ä¸Šä¸€é¡µ
        </view>
        <text class="page-info">{{currentPage}}/{{totalPages}}</text>
        <view 
          class="page-button {{currentPage === totalPages ? 'disabled' : ''}}"
          bindtap="nextPage"
        >
          ä¸‹ä¸€é¡µ
        </view>
      </view>
    </block>
  </view>
</view> 